

# 1. 유저 데이터 기반 랭체인 구현

- 유저의 학년 별 이수연도, 자료구입비, 대출건수, 방문수 추출
- llm모델에게 전달 후 랭체인을 통한 아웃풋 프롬프팅 기능 구현
- 유저의 질문 분석 후 학업 데이터 관련 vs 일반 질의 분석 로직 추가
- 분기에 따라 데이터 기반 추론 로직 발동
- ex)
```

2025-08-26 16:51:27,262 [INFO] llm_api - 일반 질문 - 기존 컨텍스트 기반 처리  
2025-08-26 16:51:57,694 [INFO] llm_api - 요약 롤링 완료: conv_id=16  
2025-08-26 16:51:57,695 [INFO] werkzeug - 127.0.0.1 - - [26/Aug/2025 16:51:57] "POST /generate HTTP/1.1" 200 -  
2025-08-26 17:07:36,464 [INFO] llm_api - [generate] usr_id='sample', first_turn=False, msg='내 4학년 점수가 몇점이었더라'  
2025-08-26 17:07:36,477 [INFO] llm_api - 학업 데이터 질문 감지 - 랭체인 사용  
2025-08-26 17:07:36,549 [INFO] user_data_chain - [UDC] via_schema sql=SELECT USR_NAME, USR_SNM, "1ST_YR", "1ST_USR_CPS", "1ST_USR_LPS", "1ST_USR_VPS", "2ND_YR", "2ND_USR_CPS", "2ND_USR_LPS", "2ND_USR_VPS", "3RD_YR", "3RD_USR_CPS", "3RD_USR_LPS", "3RD_USR_VPS", "4TH_YR", "4TH_USR_CPS", "4TH_USR_LPS", "4TH_USR_VPS", SCR_EST_1ST, SCR_EST_2ND, SCR_EST_3RD, SCR_EST_4TH FROM USER_DATA WHERE USR_ID = :usr_id  
2025-08-26 17:07:36,550 [INFO] user_data_chain - [UDC] via_schema row_dict keys=['USR_NAME', 'USR_SNM', '1ST_YR', '1ST_USR_CPS', '1ST_USR_LPS', '1ST_USR_VPS', '2ND_YR', '2ND_USR_CPS', '2ND_USR_LPS', '2ND_USR_VPS', '3RD_YR', '3RD_USR_CPS', '3RD_USR_LPS', '3RD_USR_VPS', '4TH_YR', '4TH_USR_CPS', '4TH_USR_LPS', '4TH_USR_VPS', 'SCR_EST_1ST', 'SCR_EST_2ND', 'SCR_EST_3RD', 'SCR_EST_4TH']  
2025-08-26 17:07:36,550 [INFO] user_data_chain - [UDC] via_schema row_dict probe={'USR_NAME': '곽철용', 'USR_SNM': '강원대학교', '1ST_USR_LPS': 10, '2ND_USR_LPS': 10, '3RD_USR_LPS': 10, '4TH_USR_LPS': 15, '1ST_YR': 2021, '2ND_YR': 2022, '3RD_YR': 2023, '4TH_YR': 2024, 'SCR_EST_1ST': 68.27326965332031, 'SCR_EST_2ND': 68.46980285644531, 'SCR_EST_3RD': 68.76188659667969, 'SCR_EST_4TH': 68.39236450195312}  
2025-08-26 17:07:36,551 [INFO] user_data_chain - [UDC] via_schema alias_keys=['name', 'university', 'y1.CPS', 'y1.LPS', 'y1.VPS', 'y1.score', 'y1.year', 'y2.CPS', 'y2.LPS', 'y2.VPS', 'y2.score', 'y2.year', 'y3.CPS', 'y3.LPS', 'y3.VPS', 'y3.score', 'y3.year', 'y4.CPS', 'y4.LPS', 'y4.VPS', 'y4.score', 'y4.year']  
2025-08-26 17:07:36,551 [INFO] user_data_chain - [UDC] via_schema folded_y1={'year': 2021, 'CPS': 150500, 'LPS': 10, 'VPS': 20, 'score': 68.27326965332031}  
2025-08-26 17:07:36,551 [INFO] user_data_chain - [UDC] via_schema folded_y2={'year': 2022, 'CPS': 150000, 'LPS': 10, 'VPS': 20, 'score': 68.46980285644531}  
2025-08-26 17:07:36,552 [INFO] user_data_chain - [UDC] via_schema folded_y3={'year': 2023, 'CPS': 150000, 'LPS': 10, 'VPS': 20, 'score': 68.76188659667969}  
2025-08-26 17:07:36,552 [INFO] user_data_chain - [UDC] via_schema folded_y4={'year': 2024, 'CPS': 200000, 'LPS': 15, 'VPS': 25, 'score': 68.39236450195312}  
2025-08-26 17:07:57,571 [INFO] llm_api - 요약 롤링 완료: conv_id=16  
2025-08-26 17:07:57,573 [INFO] werkzeug - 127.0.0.1 - - [26/Aug/2025 17:07:57] "POST /generate HTTP/1.1" 200 -

```



{% extends "common/base.html" %}
{% block title %}Libra | Q&A ëª©ë¡{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/question.css') }}">
{% endblock %}

{% block content %}
<section class="qna-hero fade-in">
  <div class="container">
    <div class="qna-titlebar">
      <h1>Q&amp;A</h1>
      <p class="lead">Libra ì´ìš©ê³¼ ê´€ë ¨ëœ ë¬¸ì˜ë‚˜ ì˜ê²¬ì„ ë‚¨ê¸°ëŠ” ê³³ì…ë‹ˆë‹¤. </p>
    </div>

    <div class="qna-head-actions">
      <a class="btn primary" href="{{ url_for('qna.qna_new') }}">ë¬¸ì˜í•˜ê¸°</a>
    </div>
</section>

<!-- ìƒë‹¨ í•„í„°ë°” (êµ¬ì¡°ë§Œ; ì¶”í›„ ì„œë²„ ì—°ë™ ì‹œ GET íŒŒë¼ë¯¸í„° ì‚¬ìš©) -->
<section class="qna-filterbar fade-in" aria-label="ê²€ìƒ‰/í•„í„°">
  <div class="container">
    <form method="get" action="{{ url_for('qna.qna_list') }}" class="filter-form" role="search">
      <div class="filters-left">
        <select name="kind">
          <option value="">ê²€ìƒ‰êµ¬ë¶„(ì „ì²´)</option>
          <option value="ì¼ë°˜">ì¼ë°˜</option>
          <option value="ë¯¼ì›">ë¯¼ì›</option>
        </select>
        <select name="public">
          <option value="">ê³µê°œì—¬ë¶€(ì „ì²´)</option>
          <option value="1">ê³µê°œ</option>
          <option value="0">ë¹„ê³µê°œ</option>
        </select>
        <select name="status">
          <option value="">ì²˜ë¦¬ìƒí™©(ì „ì²´)</option>
          <option value="ë‹µë³€ì™„ë£Œ">ë‹µë³€ì™„ë£Œ</option>
          <option value="ì²˜ë¦¬ì¤‘">ì²˜ë¦¬ì¤‘</option>
        </select>
      </div>
      <div class="filters-right">
        <select name="field">
          <option value="title">ì œëª©</option>
        </select>
        <input type="text" name="q" placeholder="ê²€ìƒ‰ì–´" aria-label="ê²€ìƒ‰ì–´">
        <button type="submit" class="btn primary">ê²€ìƒ‰</button>
      </div>
    </form>
  </div>
</section>

<section class="qna-list-section fade-in" aria-label="ë¬¸ì˜ ëª©ë¡">
  <div class="container">
<!-- ì´ ê±´ìˆ˜ëŠ” table ë°”ê¹¥ì—ì„œ ë Œë” (table ì•ˆì— div ë‘ë©´ í‘œê°€ ê¹¨ì§€ê³  ë°‘ì¤„ì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆìŒ) -->
    <div class="q-total">ì´ {{ total }}ê±´</div>

    <table class="qna-table" aria-describedby="qnaListCaption">
      <thead>
        <tr>
          <th style="width:7rem;">ë²ˆí˜¸</th>
          <th style="width:7rem;">êµ¬ë¶„</th>
          <th style="width:7rem;">ê³µê°œì—¬ë¶€</th>
          <th>ì œëª©</th>
          <th style="width:6rem;">ì²¨ë¶€</th>
          <th style="width:8rem;">ì§ˆë¬¸ì</th>
          <th style="width:10rem;">ë“±ë¡ì¼</th>
          <th style="width:8rem;">ì²˜ë¦¬ìƒí™©</th>
        </tr>
      </thead>
      <tbody>
        {% set no = start_no %}
        {% for it in items %}
          {% set ttl_len = it.title|length %}
          <tr>
            <td>{{ no - loop.index0 }}</td>
            <td>{{ it.kind }}</td>
            <td>{{ 'ê³µê°œ' if it.is_public else 'ë¹„ê³µê°œ' }}</td>
               <!-- ê³µê°œê¸€ë§Œ ë§í¬, ì œëª©ì€ 2ì¤„ê¹Œì§€ í´ë¨í”„ -->
            <td class="qna-title-cell">
              <!--ê³µê°œê¸€ì¼ë•Œë§Œ ìƒì„¸í˜ì´ì§€(/qua/<id>ë¡œ ì´ë™)-->
              {% if it.is_public %}
                <a class="qna-link" href="{{ url_for('qna.qna_detail', qid=it.id) }}">
                  <span class="tt {% if ttl_len > 30 %}long{% endif %}">{{ it.title }}</span>
                </a>
              {% else %}
                <span class="tt locked {% if ttl_len > 30 %}long{% endif %}">{{ it.title }}</span>
              {% endif %}
            </td>
            <td>{{ 'ğŸ“' if it.has_file else '' }}</td>
            <td>{{ it.author }}</td>
            <td>{{ it.created_at.strftime('%Y-%m-%d') }}</td>
            <td class="status {{ 'done' if it.status=='ë‹µë³€ì™„ë£Œ' else 'doing' }}">{{ it.status }}</td>
          </tr>
        {% else %}
          <tr><td colspan="8" style="padding:1.6rem;">ì•„ì§ ë“±ë¡ëœ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <nav aria-label="í˜ì´ì§€ íƒìƒ‰">
    {% set slots = 10 %}
    <ul class="pager">
      {# ì²˜ìŒ/ì´ì „ #}
      {% if page > 1 %}
        <li><a href="{{ url_for('qna.qna_list', page=1) }}">Â«</a></li>
        <li><a href="{{ url_for('qna.qna_list', page=page-1) }}">â€¹</a></li>
      {% else %}
        <li class="disabled"><span>Â«</span></li>
        <li class="disabled"><span>â€¹</span></li>
      {% endif %}

      {# 1 ~ min(slots, pages) ê¹Œì§€ ì‹¤ì œ í˜ì´ì§€ #}
      {% for i in range(1, (slots if slots < pages else pages) + 1) %}
        {% if i == page %}
          <li><span class="current">{{ i }}</span></li>
        {% else %}
          <li><a href="{{ url_for('qna.qna_list', page=i) }}">{{ i }}</a></li>
        {% endif %}
      {% endfor %}

      {# ë‚¨ëŠ” ìŠ¬ë¡¯(í˜ì´ì§€ìˆ˜ê°€ 10 ë¯¸ë§Œì´ë©´ ë¹„í™œì„±ìœ¼ë¡œ ì±„ì›€) #}
      {% if pages < slots %}
        {% for j in range(pages+1, slots+1) %}
          <li class="disabled"><span>{{ j }}</span></li>
        {% endfor %}
      {% endif %}

      {# ë‹¤ìŒ/ë§ˆì§€ë§‰ #}
      {% if page < pages %}
        <li><a href="{{ url_for('qna.qna_list', page=page+1) }}">â€º</a></li>
        <li><a href="{{ url_for('qna.qna_list', page=pages) }}">Â»</a></li>
      {% else %}
        <li class="disabled"><span>â€º</span></li>
        <li class="disabled"><span>Â»</span></li>
      {% endif %}
    </ul>

</nav>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  // ì„¹ì…˜ í˜ì´ë“œì¸
  const io = new IntersectionObserver(es => es.forEach(e => { if (e.isIntersecting) e.target.classList.add('appear'); }), {threshold:.15});
  document.querySelectorAll('.fade-in').forEach(el => io.observe(el));
</script>
{% endblock %}

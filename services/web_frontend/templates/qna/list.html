{% extends "common/base.html" %}
{% block title %}Libra | Q&A 목록{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/question.css') }}">
{% endblock %}

{% block content %}
<section class="qna-hero fade-in">
  <div class="container">
    <div class="qna-titlebar">
      <h1>Q&amp;A</h1>
      <p class="lead">Libra 이용과 관련된 문의나 의견을 남기는 곳입니다. </p>
    </div>

    <div class="qna-head-actions">
      <a class="btn primary" href="{{ url_for('qna.qna_new') }}">문의하기</a>
    </div>
</section>

<!-- 상단 필터바 (구조만; 추후 서버 연동 시 GET 파라미터 사용) -->
<section class="qna-filterbar fade-in" aria-label="검색/필터">
  <div class="container">
    <form method="get" action="{{ url_for('qna.qna_list') }}" class="filter-form" role="search">
      <div class="filters-left">
        <select name="kind">
          <option value="">검색구분(전체)</option>
          <option value="일반">일반</option>
          <option value="민원">민원</option>
        </select>
        <select name="public">
          <option value="">공개여부(전체)</option>
          <option value="1">공개</option>
          <option value="0">비공개</option>
        </select>
        <select name="status">
          <option value="">처리상황(전체)</option>
          <option value="답변완료">답변완료</option>
          <option value="처리중">처리중</option>
        </select>
      </div>
      <div class="filters-right">
        <select name="field">
          <option value="title">제목</option>
        </select>
        <input type="text" name="q" placeholder="검색어" aria-label="검색어">
        <button type="submit" class="btn primary">검색</button>
      </div>
    </form>
  </div>
</section>

<section class="qna-list-section fade-in" aria-label="문의 목록">
  <div class="container">
<!-- 총 건수는 table 바깥에서 렌더 (table 안에 div 두면 표가 깨지고 밑줄처럼 보일 수 있음) -->
    <div class="q-total">총 {{ total }}건</div>

    <table class="qna-table" aria-describedby="qnaListCaption">
      <thead>
        <tr>
          <th style="width:7rem;">번호</th>
          <th style="width:7rem;">구분</th>
          <th style="width:7rem;">공개여부</th>
          <th>제목</th>
          <th style="width:6rem;">첨부</th>
          <th style="width:8rem;">질문자</th>
          <th style="width:10rem;">등록일</th>
          <th style="width:8rem;">처리상황</th>
        </tr>
      </thead>
      <tbody>
        {% set no = start_no %}
        {% for it in items %}
          {% set ttl_len = it.title|length %}
          <tr>
            <td>{{ no - loop.index0 }}</td>
            <td>{{ it.kind }}</td>
            <td>{{ '공개' if it.is_public else '비공개' }}</td>
               <!-- 공개글만 링크, 제목은 2줄까지 클램프 -->
            <td class="qna-title-cell">
              <!--공개글일때만 상세페이지(/qua/<id>로 이동)-->
              {% if it.is_public %}
                <a class="qna-link" href="{{ url_for('qna.qna_detail', qid=it.id) }}">
                  <span class="tt {% if ttl_len > 30 %}long{% endif %}">{{ it.title }}</span>
                </a>
              {% else %}
                <span class="tt locked {% if ttl_len > 30 %}long{% endif %}">{{ it.title }}</span>
              {% endif %}
            </td>
            <td>{{ '📎' if it.has_file else '' }}</td>
            <td>{{ it.author }}</td>
            <td>{{ it.created_at.strftime('%Y-%m-%d') }}</td>
            <td class="status {{ 'done' if it.status=='답변완료' else 'doing' }}">{{ it.status }}</td>
          </tr>
        {% else %}
          <tr><td colspan="8" style="padding:1.6rem;">아직 등록된 문의가 없습니다.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <nav aria-label="페이지 탐색">
    {% set slots = 10 %}
    <ul class="pager">
      {# 처음/이전 #}
      {% if page > 1 %}
        <li><a href="{{ url_for('qna.qna_list', page=1) }}">«</a></li>
        <li><a href="{{ url_for('qna.qna_list', page=page-1) }}">‹</a></li>
      {% else %}
        <li class="disabled"><span>«</span></li>
        <li class="disabled"><span>‹</span></li>
      {% endif %}

      {# 1 ~ min(slots, pages) 까지 실제 페이지 #}
      {% for i in range(1, (slots if slots < pages else pages) + 1) %}
        {% if i == page %}
          <li><span class="current">{{ i }}</span></li>
        {% else %}
          <li><a href="{{ url_for('qna.qna_list', page=i) }}">{{ i }}</a></li>
        {% endif %}
      {% endfor %}

      {# 남는 슬롯(페이지수가 10 미만이면 비활성으로 채움) #}
      {% if pages < slots %}
        {% for j in range(pages+1, slots+1) %}
          <li class="disabled"><span>{{ j }}</span></li>
        {% endfor %}
      {% endif %}

      {# 다음/마지막 #}
      {% if page < pages %}
        <li><a href="{{ url_for('qna.qna_list', page=page+1) }}">›</a></li>
        <li><a href="{{ url_for('qna.qna_list', page=pages) }}">»</a></li>
      {% else %}
        <li class="disabled"><span>›</span></li>
        <li class="disabled"><span>»</span></li>
      {% endif %}
    </ul>

</nav>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  // 섹션 페이드인
  const io = new IntersectionObserver(es => es.forEach(e => { if (e.isIntersecting) e.target.classList.add('appear'); }), {threshold:.15});
  document.querySelectorAll('.fade-in').forEach(el => io.observe(el));
</script>
{% endblock %}
